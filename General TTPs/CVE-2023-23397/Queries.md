# Splunk
## TTP hunt
```
| tstats `security_content_summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process IN ("*rundll32.exe*davclnt.dll\,DavSetCookie*") by Processes.user Processes.process_name Processes.parent_process_name Processes.dest
| `drop_dm_object_name(Processes)`
| rex field=process ".*https?:\/\/(?<http_url>[^\s]+).*"
| where isnotnull(http_url)
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)`
| table dest, user, firstTime, lastTime, parent_process_name, parent_process, process_name, process, http_url
```

# MS Defender
## TTP hunt
```
DeviceProcessEvents 
| where Timestamp > ago(30d) 
| where InitiatingProcessFileName=~ "svchost.exe"
| where ProcessCommandLine matches regex @"(?i).*davclnt\.dll\,DavSetCookie.*https?:\/\/.*"
| project Timestamp, FileName, ProcessCommandLine, FolderPath, FileSize, InitiatingProcessAccountDomain, InitiatingProcessAccountName, InitiatingProcessFileName, InitiatingProcessCommandLine, InitiatingProcessFolderPath
```

# CrowdStrike
## TTP hunt
```
event_platform IN (win) event_simpleName=ProcessRollup2 ("davclnt" OR "DavSetCookie")
| regex CommandLine="(?i).*davclnt\.dll\,DavSetCookie.*https?:\/\/.*"
| stats dc(FileName) as fnameCount, earliest(ProcessStartTime_decimal) as firstRun, latest(ProcessStartTime_decimal) as lastRun, values(FileName) as filesRun, values(CommandLine) as cmdsRun by company, cid, aid, ComputerName, ParentBaseFileName, ParentProcessId_decimal
| eval graphExplorer=case(ParentProcessId_decimal!="","https://falcon.eu-1.crowdstrike.com/graphs/process-explorer/tree?id=pid:".aid.":".ParentProcessId_decimal)
| convert ctime(firstRun), ctime(lastRun)
| table company, cid, aid, ComputerName, ParentBaseFileName, filesRun, cmdsRun, firstRun, lastRun, graphExplorer
```